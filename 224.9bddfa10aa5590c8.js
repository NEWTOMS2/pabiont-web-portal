"use strict";(self.webpackChunkpabiont_web_portal=self.webpackChunkpabiont_web_portal||[]).push([[224],{9224:(O,g,a)=>{a.r(g),a.d(g,{UsersManagementModule:()=>V});var c=a(9808),d=a(7330),v=a(5861),e=a(5e3),i=a(3075);class f{constructor(n,t,o,s,l,u,x,H){this.first_name=n,this.last_name=t,this.email=o,this.rol=s,this.phone=l,this.idEmpresa=u,this.password=x,this.code=H}}var E=a(7206);class T{constructor(n,t,o){this.to=n,this.password=t,this.template=o}}var p=a(4004),b=a(3447),h=a(8622);let C=(()=>{class r{constructor(t,o){this.httpService=t,this.appConfig=o}saveUser(t,o){return o?this.httpService.patch(`${this.appConfig.config.url.saveUser}`,t).pipe((0,p.U)(s=>s.data)):this.httpService.post(`${this.appConfig.config.url.saveUser}`,t).pipe((0,p.U)(s=>s.data))}getUser(){return this.httpService.get(`${this.appConfig.config.url.getUser}`).pipe((0,p.U)(t=>t.data))}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(b.O),e.LFG(h._))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),A=(()=>{class r{constructor(t,o){this.httpService=t,this.appConfig=o}sendEmail(t){return console.log(t),this.httpService.post(`${this.appConfig.config.url.sendEmail}`,t).pipe((0,p.U)(o=>o.data))}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(b.O),e.LFG(h._))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var _=a(1424),G=a(4036);function F(r,n){1&r&&(e.TgZ(0,"small",15),e._uU(1,"El nombre es obligatorio."),e.qZA())}function L(r,n){1&r&&(e.TgZ(0,"small",15),e._uU(1,"El apellido es obligatorio."),e.qZA())}function q(r,n){1&r&&(e.TgZ(0,"small",15),e._uU(1,"El Tel\xe9fono es Obligatorio."),e.qZA())}function S(r,n){1&r&&(e.TgZ(0,"small",15),e._uU(1,"El Rol es obligatorio."),e.qZA())}function y(r,n){1&r&&(e.TgZ(0,"small",15),e._uU(1,"El email es obligatorio."),e.qZA())}const m=function(r){return{"ng-dirty ng-invalid":r}};let U=(()=>{class r{constructor(t,o,s){this.formBuilder=t,this.usersManagementService=o,this.sendEmailManagementService=s,this.rolList=[{label:"Cliente",value:"Cliente"},{label:"Administrador",value:"Administrador"}],this.idEmpresa=1,this.isUpdate=!1,this.updateList=new e.vpe,this.buttonEnabled=new e.vpe,this.resetForm()}ngOnInit(){}convertirTexto(t){return E.AES.encrypt(t,"pabiont123").toString()}resetForm(){this.formGroup=this.formBuilder.group({first_name:["",i.kI.required],last_name:["",i.kI.required],email:["",i.kI.required],rol:["",i.kI.required],phone:["",i.kI.required]}),this.formGroup.statusChanges.subscribe(t=>{this.buttonEnabled.emit("VALID"==t)})}submit(){this.isUpdate?this.userRow=new f(this.formGroup.controls.first_name.value,this.formGroup.controls.last_name.value,this.formGroup.controls.email.value,this.formGroup.controls.rol.value.value,this.formGroup.controls.phone.value,this.formGroup.controls.code.value):"Administrador"==this.formGroup.controls.rol.value.value?(this.password=this.generateP(),this.userRow=new f(this.formGroup.controls.first_name.value,this.formGroup.controls.last_name.value,this.formGroup.controls.email.value,this.formGroup.controls.rol.value.value,this.formGroup.controls.phone.value,this.idEmpresa,this.convertirTexto(this.password))):this.userRow=new f(this.formGroup.controls.first_name.value,this.formGroup.controls.last_name.value,this.formGroup.controls.email.value,this.formGroup.controls.rol.value.value,this.formGroup.controls.phone.value,this.idEmpresa),console.log(this.userRow),this.usersManagementService.saveUser(this.userRow,this.isUpdate).subscribe(t=>{this.updateList.emit()},t=>{console.log(t)}),"Administrador"==this.formGroup.controls.rol.value.value&&0==this.isUpdate&&(this.sendEmailCredentialRow=new T(this.formGroup.controls.email.value,this.password,"credential"),this.sendEmail(this.sendEmailCredentialRow))}sendEmail(t){var o=this;return(0,v.Z)(function*(){yield o.sendEmailManagementService.sendEmail(t).subscribe(s=>{},s=>{console.log(s)})})()}updateForm(t){console.log(this.generateP()),this.formGroup.controls.rol.setValue(this.rolList.find(o=>t.rol==o.value)),this.formGroup.controls.first_name.setValue(t.first_name),this.formGroup.controls.last_name.setValue(t.last_name),this.formGroup.controls.email.setValue(t.email),this.formGroup.controls.phone.setValue(t.phone),this.idEmpresa=t.idEmpresa,this.formGroup.controls.email.disable(),this.formGroup.controls.rol.disable(),this.isUpdate=!0}generateP(){var t="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$";for(let l=1;l<=8;l++){var s=Math.floor(Math.random()*o.length+1);t+=o.charAt(s)}return t}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(i.qu),e.Y36(C),e.Y36(A))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-create-form"]],outputs:{updateList:"updateList",buttonEnabled:"buttonEnabled"},decls:28,vars:22,consts:[[3,"formGroup"],[1,"row","p-formgrid","p-grid","mt-3"],[1,"p-field","col-6"],["for","First_name"],["type","text","id","First_name","pInputText","","formControlName","first_name","required","","autofocus","",3,"ngClass"],["class","p-error",4,"ngIf"],["for","Last_name"],["type","text","id","Last_name","pInputText","","formControlName","last_name","required","","autofocus","",3,"ngClass"],["for","Phone"],["type","text","id","Tel\xe9fono","pInputText","","formControlName","phone","required","",3,"ngClass"],["for","Rol"],["optionLabel","label","styleClass","w-100","placeholder","Selecciona el rol","formControlName","rol",3,"options","ngClass"],[1,"p-field","mt-3"],["for","Email"],["type","text","id","Email","pInputText","","formControlName","email","required","","autofocus","",3,"ngClass"],[1,"p-error"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0)(1,"div",1)(2,"div",2)(3,"label",3),e._uU(4,"Nombre"),e.qZA(),e._UZ(5,"input",4),e.YNc(6,F,2,0,"small",5),e.qZA(),e.TgZ(7,"div",2)(8,"label",6),e._uU(9,"Apellido"),e.qZA(),e._UZ(10,"input",7),e.YNc(11,L,2,0,"small",5),e.qZA()(),e.TgZ(12,"div",1)(13,"div",2)(14,"label",8),e._uU(15,"Tel\xe9fono"),e.qZA(),e._UZ(16,"input",9),e.YNc(17,q,2,0,"small",5),e.qZA(),e.TgZ(18,"div",2)(19,"label",10),e._uU(20,"Rol"),e.qZA(),e._UZ(21,"p-dropdown",11),e.YNc(22,S,2,0,"small",5),e.qZA()(),e.TgZ(23,"div",12)(24,"label",13),e._uU(25,"Email"),e.qZA(),e._UZ(26,"input",14),e.YNc(27,y,2,0,"small",5),e.qZA()()),2&t&&(e.Q6J("formGroup",o.formGroup),e.xp6(5),e.Q6J("ngClass",e.VKq(12,m,o.formGroup.controls.first_name.touched&&(null==o.formGroup.controls.first_name.errors?null:o.formGroup.controls.first_name.errors.required))),e.xp6(1),e.Q6J("ngIf",o.formGroup.controls.first_name.touched&&(null==o.formGroup.controls.first_name.errors?null:o.formGroup.controls.first_name.errors.required)),e.xp6(4),e.Q6J("ngClass",e.VKq(14,m,o.formGroup.controls.last_name.touched&&(null==o.formGroup.controls.last_name.errors?null:o.formGroup.controls.last_name.errors.required))),e.xp6(1),e.Q6J("ngIf",o.formGroup.controls.last_name.touched&&(null==o.formGroup.controls.last_name.errors?null:o.formGroup.controls.last_name.errors.required)),e.xp6(5),e.Q6J("ngClass",e.VKq(16,m,o.formGroup.controls.phone.touched&&(null==o.formGroup.controls.phone.errors?null:o.formGroup.controls.phone.errors.required))),e.xp6(1),e.Q6J("ngIf",o.formGroup.controls.phone.touched&&(null==o.formGroup.controls.phone.errors?null:o.formGroup.controls.phone.errors.required)),e.xp6(4),e.Q6J("options",o.rolList)("ngClass",e.VKq(18,m,o.formGroup.controls.rol.touched&&(null==o.formGroup.controls.rol.errors?null:o.formGroup.controls.rol.errors.required))),e.xp6(1),e.Q6J("ngIf",o.formGroup.controls.rol.touched&&(null==o.formGroup.controls.rol.errors?null:o.formGroup.controls.rol.errors.required)),e.xp6(4),e.Q6J("ngClass",e.VKq(20,m,o.formGroup.controls.email.touched&&(null==o.formGroup.controls.email.errors?null:o.formGroup.controls.email.errors.required))),e.xp6(1),e.Q6J("ngIf",o.formGroup.controls.email.touched&&(null==o.formGroup.controls.email.errors?null:o.formGroup.controls.email.errors.required)))},directives:[i._Y,i.JL,i.sg,i.Fj,_.o,i.JJ,i.u,i.Q7,c.mk,c.O5,G.Lt],styles:[""]}),r})();var I=a(135),J=a(3833),M=a(5315),w=a(9783),Z=a(845);function N(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){return e.CHM(t),e.oxw().hideDialog()}),e.qZA(),e.TgZ(1,"button",11),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(),l=e.MAs(7);return s.hideDialog(),l.submit()}),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Q6J("disabled",!t.buttonIsEnabled)}}const B=function(){return{width:"450px"}},Q=[{path:"",component:(()=>{class r{constructor(t,o,s,l){this.appConfig=t,this.tableManagmentService=o,this.userManagementService=s,this.router=l,this.visibleDialog=!1,this.buttonIsEnabled=!1,this.userList=[],this.page=this.appConfig.userManagement,this.page=this.page.default,this.getUserList(),this.tableManagmentService.buttonEvent.subscribe(u=>{this.selectedButton(u)})}ngOnInit(){}getUserList(){var t=this;return(0,v.Z)(function*(){t.userList=yield t.userManagementService.getUser().toPromise().then(o=>o)})()}buttonEnabled(t){this.buttonIsEnabled=t}selectedButton(t){1===(this.visibleDialog=!0,t.buttonId)&&this.child.updateForm(t.rowData)}hideDialog(){this.visibleDialog=!1}redirect(){this.router.navigate(["main"])}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(h._),e.Y36(I.l),e.Y36(C),e.Y36(d.F0))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-users-management"]],viewQuery:function(t,o){if(1&t&&e.Gf(U,5),2&t){let s;e.iGM(s=e.CRH())&&(o.child=s.first)}},decls:11,vars:11,consts:[[1,"row","p-5","m-0"],[1,"title"],[1,"pabiont-card"],[3,"headerList","headerCustomButtons","customButtons","dataList","searchField","canCreate"],["header","Agregar Clientes","styleClass","p-fluid",3,"visible","modal","visibleChange","onHide"],[3,"buttonEnabled","updateList"],["child",""],["class","m-0","pTemplate","footer"],[1,"d-flex","justify-content-start","px-5","mb-3"],["pButton","","pRipple","","label","Volver",1,"p-button-outlined",3,"click"],["pButton","","pRipple","","label","Cancelar","icon","pi pi-times",1,"p-button-text","p-button-danger",3,"click"],["pButton","","pRipple","","label","Guardar","icon","pi pi-check",1,"p-button-text",3,"disabled","click"]],template:function(t,o){if(1&t){const s=e.EpF();e.TgZ(0,"div",0)(1,"span",1),e._uU(2,"Gestion de Clientes"),e.qZA(),e.TgZ(3,"div",2),e._UZ(4,"app-basic-table",3),e.qZA()(),e.TgZ(5,"p-dialog",4),e.NdJ("visibleChange",function(u){return o.visibleDialog=u})("onHide",function(){return e.CHM(s),e.MAs(7).resetForm()}),e.TgZ(6,"app-create-form",5,6),e.NdJ("buttonEnabled",function(u){return o.buttonEnabled(u)})("updateList",function(){return o.getUserList()}),e.qZA(),e.YNc(8,N,2,1,"ng-template",7),e.qZA(),e.TgZ(9,"div",8)(10,"button",9),e.NdJ("click",function(){return o.redirect()}),e.qZA()()}2&t&&(e.xp6(4),e.Q6J("headerList",o.page.tableConfiguration.headerList)("headerCustomButtons",o.page.tableConfiguration.headerCustomButtons)("customButtons",o.page.tableConfiguration.customButtons)("dataList",o.userList)("searchField",o.page.tableConfiguration.searchField)("canCreate",!0),e.xp6(1),e.Akn(e.DdM(10,B)),e.Q6J("visible",o.visibleDialog)("modal",!0))},directives:[J.N,M.V,U,w.jx,Z.Hq],styles:[".title[_ngcontent-%COMP%]{font-weight:600;font-size:32px;line-height:27px;color:#000;margin-bottom:48px}.pabiont-card[_ngcontent-%COMP%]{border-radius:20px;border:2px solid rgba(0,0,0,.05);box-shadow:0 4px 4px #00000040}"]}),r})()}];let R=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[d.Bz.forChild(Q)],d.Bz]}),r})();var Y=a(732);let V=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[c.ez,R,Y.T,Z.hJ,_.j,M.S,i.UX,G.kW]]}),r})()}}]);