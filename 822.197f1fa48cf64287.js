"use strict";(self.webpackChunkpabiont_web_portal=self.webpackChunkpabiont_web_portal||[]).push([[822],{7600:(k,c,n)=>{n.r(c),n.d(c,{UsersManagementModule:()=>H});var p=n(9808),d=n(7330),f=n(5861),e=n(5e3),a=n(3075),h=n(272),A=n(7206);class T{constructor(s,o,t){this.to=s,this.password=o,this.template=t}}var g=n(9643),y=n(4004),F=n(3447),v=n(6456);let S=(()=>{class r{constructor(o,t){this.httpService=o,this.appConfig=t}sendEmail(o){return console.log(o),this.httpService.post(`${this.appConfig.config.url.sendEmail}`,o).pipe((0,y.U)(t=>t.data))}}return r.\u0275fac=function(o){return new(o||r)(e.LFG(F.O),e.LFG(v._))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var b=n(9783),C=n(1424),G=n(2537),U=n(4036);function L(r,s){1&r&&(e.TgZ(0,"small",15),e._uU(1,"El nombre es obligatorio."),e.qZA())}function I(r,s){1&r&&(e.TgZ(0,"small",15),e._uU(1,"El apellido es obligatorio."),e.qZA())}function q(r,s){1&r&&(e.TgZ(0,"small",15),e._uU(1,"El Tel\xe9fono es Obligatorio."),e.qZA())}function J(r,s){1&r&&(e.TgZ(0,"small",15),e._uU(1,"El Rol es obligatorio."),e.qZA())}function N(r,s){1&r&&(e.TgZ(0,"small",15),e._uU(1,"El email es obligatorio."),e.qZA())}const u=function(r){return{"ng-dirty ng-invalid":r}};let _=(()=>{class r{constructor(o,t,i,l){this.formBuilder=o,this.usersManagementService=t,this.sendEmailManagementService=i,this.messageService=l,this.rolList=[{label:"Agente",value:"Agente"},{label:"Administrador",value:"Administrador"}],this.idEmpresa=1,this.isUpdate=!1,this.updateList=new e.vpe,this.buttonEnabled=new e.vpe,this.resetForm()}ngOnInit(){}convertirTexto(o){return A.AES.encrypt(o,"pabiont123").toString()}resetForm(){this.formGroup=this.formBuilder.group({first_name:["",[a.kI.required,a.kI.pattern("[a-zA-Z ]*")]],last_name:["",[a.kI.required,a.kI.pattern("[a-zA-Z ]*")]],email:["",[a.kI.required,a.kI.pattern(/^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/)]],rol:["",a.kI.required],phone:["",a.kI.required]}),this.formGroup.statusChanges.subscribe(o=>{this.buttonEnabled.emit("VALID"==o)})}submit(){this.isUpdate?this.userRow=new h.s(this.formGroup.controls.first_name.value,this.formGroup.controls.last_name.value,this.formGroup.controls.email.value,this.formGroup.controls.rol.value.value,this.formGroup.controls.phone.value,1,"",this.code):(this.password=this.generateP(),this.userRow=new h.s(this.formGroup.controls.first_name.value,this.formGroup.controls.last_name.value,this.formGroup.controls.email.value,this.formGroup.controls.rol.value.value,this.formGroup.controls.phone.value,this.idEmpresa,this.convertirTexto(this.password))),this.usersManagementService.saveUser(this.userRow,this.isUpdate).subscribe(o=>{this.messageService.add({severity:"success",summary:"Usuario creado o modificado correctamente.",detail:""}),this.generateEmail(this.isUpdate),this.updateList.emit()},o=>{o.error.some(t=>"User already exist"===t.error_description)?this.messageService.add({severity:"error",summary:"el Usuario ya existe, intente un correo diferente.",detail:""}):this.messageService.add({severity:"error",summary:"Ha ocurrido un error al crear o modificar el Usuario.",detail:""})})}generateEmail(o){0==o&&(this.sendEmailCredentialRow=new T(this.formGroup.controls.email.value,this.password,"credential"),this.sendEmail(this.sendEmailCredentialRow))}sendEmail(o){var t=this;return(0,f.Z)(function*(){yield t.sendEmailManagementService.sendEmail(o).subscribe(i=>{t.messageService.add({severity:"success",summary:"Email enviado con la contrase\xf1a al Usuario creado.",detail:""})},i=>{t.messageService.add({severity:"error",summary:"Ha ocurrido un error al enviar el email al usuario.",detail:""}),console.log(i)})})()}enable(){this.formGroup.controls.email.enable(),this.formGroup.controls.rol.enable(),this.isUpdate=!1}updateForm(o){this.formGroup.controls.rol.setValue(this.rolList.find(t=>o.rol==t.value)),this.formGroup.controls.first_name.setValue(o.first_name),this.formGroup.controls.last_name.setValue(o.last_name),this.formGroup.controls.email.setValue(o.email),this.formGroup.controls.phone.setValue(o.phone),this.idEmpresa=o.idEmpresa,this.code=o.code,this.formGroup.controls.email.disable(),this.formGroup.controls.rol.disable(),this.isUpdate=!0}generateP(){var o="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$";for(let l=1;l<=8;l++){var i=Math.floor(Math.random()*t.length+1);o+=t.charAt(i)}return o}}return r.\u0275fac=function(o){return new(o||r)(e.Y36(a.qu),e.Y36(g.D),e.Y36(S),e.Y36(b.ez))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-create-form"]],outputs:{updateList:"updateList",buttonEnabled:"buttonEnabled"},decls:28,vars:22,consts:[[3,"formGroup"],[1,"row","p-formgrid","p-grid","mt-3"],[1,"p-field","col-6"],["for","First_name"],["type","text","id","First_name","pattern","[a-zA-Z ]*","pInputText","","formControlName","first_name","required","","autofocus","",3,"ngClass"],["class","p-error",4,"ngIf"],["for","Last_name"],["type","text","id","Last_name","pattern","[a-zA-Z ]*","pInputText","","formControlName","last_name","required","","autofocus","",3,"ngClass"],["for","Phone"],["formControlName","phone","id","Tel\xe9fono","mask","+99 (999) 999-9999","placeholder","+99 (999) 999-9999",3,"ngClass"],["for","Rol"],["optionLabel","label","styleClass","w-100","placeholder","Selecciona el rol","formControlName","rol",3,"options","ngClass"],[1,"p-field","mt-3"],["for","Email"],["type","text","id","Email","placeholder","abcd@abcd.abcd","pInputText","","formControlName","email","required","","autofocus","",3,"ngClass"],[1,"p-error"]],template:function(o,t){1&o&&(e.TgZ(0,"form",0)(1,"div",1)(2,"div",2)(3,"label",3),e._uU(4,"Nombre"),e.qZA(),e._UZ(5,"input",4),e.YNc(6,L,2,0,"small",5),e.qZA(),e.TgZ(7,"div",2)(8,"label",6),e._uU(9,"Apellido"),e.qZA(),e._UZ(10,"input",7),e.YNc(11,I,2,0,"small",5),e.qZA()(),e.TgZ(12,"div",1)(13,"div",2)(14,"label",8),e._uU(15,"Tel\xe9fono"),e.qZA(),e._UZ(16,"p-inputMask",9),e.YNc(17,q,2,0,"small",5),e.qZA(),e.TgZ(18,"div",2)(19,"label",10),e._uU(20,"Rol"),e.qZA(),e._UZ(21,"p-dropdown",11),e.YNc(22,J,2,0,"small",5),e.qZA()(),e.TgZ(23,"div",12)(24,"label",13),e._uU(25,"Email"),e.qZA(),e._UZ(26,"input",14),e.YNc(27,N,2,0,"small",5),e.qZA()()),2&o&&(e.Q6J("formGroup",t.formGroup),e.xp6(5),e.Q6J("ngClass",e.VKq(12,u,t.formGroup.controls.first_name.touched&&(null==t.formGroup.controls.first_name.errors?null:t.formGroup.controls.first_name.errors.required))),e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.first_name.touched&&(null==t.formGroup.controls.first_name.errors?null:t.formGroup.controls.first_name.errors.required)),e.xp6(4),e.Q6J("ngClass",e.VKq(14,u,t.formGroup.controls.last_name.touched&&(null==t.formGroup.controls.last_name.errors?null:t.formGroup.controls.last_name.errors.required))),e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.last_name.touched&&(null==t.formGroup.controls.last_name.errors?null:t.formGroup.controls.last_name.errors.required)),e.xp6(5),e.Q6J("ngClass",e.VKq(16,u,t.formGroup.controls.phone.touched&&(null==t.formGroup.controls.phone.errors?null:t.formGroup.controls.phone.errors.required))),e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.phone.touched&&(null==t.formGroup.controls.phone.errors?null:t.formGroup.controls.phone.errors.required)),e.xp6(4),e.Q6J("options",t.rolList)("ngClass",e.VKq(18,u,t.formGroup.controls.rol.touched&&(null==t.formGroup.controls.rol.errors?null:t.formGroup.controls.rol.errors.required))),e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.rol.touched&&(null==t.formGroup.controls.rol.errors?null:t.formGroup.controls.rol.errors.required)),e.xp6(4),e.Q6J("ngClass",e.VKq(20,u,t.formGroup.controls.email.touched&&(null==t.formGroup.controls.email.errors?null:t.formGroup.controls.email.errors.required))),e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.email.touched&&(null==t.formGroup.controls.email.errors?null:t.formGroup.controls.email.errors.required)))},directives:[a._Y,a.JL,a.sg,a.Fj,a.c5,C.o,a.JJ,a.u,a.Q7,p.mk,p.O5,G.vy,U.Lt],styles:[""]}),r})();var B=n(135),Z=n(7773),Q=n(3833),M=n(5315),E=n(845);function Y(r,s){if(1&r){const o=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){return e.CHM(o),e.oxw().hideDialog()}),e.qZA(),e.TgZ(1,"button",11),e.NdJ("click",function(){e.CHM(o);const i=e.oxw(),l=e.MAs(8);return i.hideDialog(),l.submit()}),e.qZA()}if(2&r){const o=e.oxw();e.xp6(1),e.Q6J("disabled",!o.buttonIsEnabled)}}const z=function(){return{width:"450px"}},R=[{path:"",component:(()=>{class r{constructor(o,t,i,l){this.appConfig=o,this.tableManagmentService=t,this.userManagementService=i,this.router=l,this.visibleDialog=!1,this.buttonIsEnabled=!1,this.userList=[],this.currentStep=-1,this.page=this.appConfig.userManagement,this.page=this.page.default,this.getUserList(),this.tableManagmentService.buttonEvent.subscribe(m=>{this.selectedButton(m)})}ngOnInit(){}getUserList(){var o=this;return(0,f.Z)(function*(){o.userList=yield o.userManagementService.getUserAdmin().toPromise().then(t=>t)})()}buttonEnabled(o){this.buttonIsEnabled=o}selectedButton(o){switch(this.visibleDialog=!0,this.currentStep=o.buttonId,o.buttonId){case 0:this.child.enable();break;case 1:this.child.updateForm(o.rowData)}}hideDialog(){this.visibleDialog=!1,this.currentStep=-1}redirect(){this.router.navigate(["main"])}}return r.\u0275fac=function(o){return new(o||r)(e.Y36(v._),e.Y36(B.l),e.Y36(g.D),e.Y36(d.F0))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-users-management"]],viewQuery:function(o,t){if(1&o&&e.Gf(_,5),2&o){let i;e.iGM(i=e.CRH())&&(t.child=i.first)}},decls:12,vars:11,consts:[[1,"row","p-5","m-0"],[1,"title"],[1,"pabiont-card"],[3,"headerList","headerCustomButtons","customButtons","dataList","searchField","canCreate"],["header","Agregar o Modificar Usuarios","styleClass","p-fluid",3,"visible","modal","visibleChange","onHide"],[3,"buttonEnabled","updateList"],["child",""],["class","m-0","pTemplate","footer"],[1,"d-flex","justify-content-start","px-5","mb-3"],["pButton","","pRipple","","label","Volver",1,"p-button-outlined",3,"click"],["pButton","","pRipple","","label","Cancelar","icon","pi pi-times",1,"p-button-text","p-button-danger",3,"click"],["pButton","","pRipple","","label","Guardar","icon","pi pi-check",1,"p-button-text",3,"disabled","click"]],template:function(o,t){if(1&o){const i=e.EpF();e._UZ(0,"p-toast"),e.TgZ(1,"div",0)(2,"span",1),e._uU(3,"Gesti\xf3n de Usuarios"),e.qZA(),e.TgZ(4,"div",2),e._UZ(5,"app-basic-table",3),e.qZA()(),e.TgZ(6,"p-dialog",4),e.NdJ("visibleChange",function(m){return t.visibleDialog=m})("onHide",function(){return e.CHM(i),e.MAs(8).resetForm()}),e.TgZ(7,"app-create-form",5,6),e.NdJ("buttonEnabled",function(m){return t.buttonEnabled(m)})("updateList",function(){return t.getUserList()}),e.qZA(),e.YNc(9,Y,2,1,"ng-template",7),e.qZA(),e.TgZ(10,"div",8)(11,"button",9),e.NdJ("click",function(){return t.redirect()}),e.qZA()()}2&o&&(e.xp6(5),e.Q6J("headerList",t.page.tableConfiguration.headerList)("headerCustomButtons",t.page.tableConfiguration.headerCustomButtons)("customButtons",t.page.tableConfiguration.customButtons)("dataList",t.userList)("searchField",t.page.tableConfiguration.searchField)("canCreate",!0),e.xp6(1),e.Akn(e.DdM(10,z)),e.Q6J("visible",t.visibleDialog)("modal",!0))},directives:[Z.FN,Q.N,M.V,_,b.jx,E.Hq],styles:[".title[_ngcontent-%COMP%]{font-weight:600;font-size:32px;line-height:27px;color:#000;margin-bottom:48px}.pabiont-card[_ngcontent-%COMP%]{border-radius:20px;border:2px solid rgba(0,0,0,.05);box-shadow:0 4px 4px #00000040}"]}),r})()}];let V=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[d.Bz.forChild(R)],d.Bz]}),r})();var x=n(732);let H=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[p.ez,V,x.T,E.hJ,C.j,M.S,a.UX,U.kW,G.zz,Z.EV]]}),r})()}}]);